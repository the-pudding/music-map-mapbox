!function(e){var t={};function n(l){if(t[l])return t[l].exports;var i=t[l]={i:l,l:!1,exports:{}};return e[l].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,l){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(l,i,function(t){return e[t]}.bind(null,i));return l},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){(function(t){var n=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,r=/^0o[0-7]+$/i,a=parseInt,o="object"==typeof t&&t&&t.Object===Object&&t,s="object"==typeof self&&self&&self.Object===Object&&self,c=o||s||Function("return this")(),u=Object.prototype.toString,d=Math.max,p=Math.min,f=function(){return c.Date.now()};function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function m(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return NaN;if(y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var o=i.test(e);return o||r.test(e)?a(e.slice(2),o?2:8):l.test(e)?NaN:+e}e.exports=function(e,t,n){var l,i,r,a,o,s,c=0,u=!1,b=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var n=l,r=i;return l=i=void 0,c=t,a=e.apply(r,n)}function k(e){return c=e,o=setTimeout(h,t),u?g(e):a}function x(e){var n=e-s;return void 0===s||n>=t||n<0||b&&e-c>=r}function h(){var e=f();if(x(e))return _(e);o=setTimeout(h,function(e){var n=t-(e-s);return b?p(n,r-(e-c)):n}(e))}function _(e){return o=void 0,v&&l?g(e):(l=i=void 0,a)}function w(){var e=f(),n=x(e);if(l=arguments,i=this,s=e,n){if(void 0===o)return k(s);if(b)return o=setTimeout(h,t),g(s)}return void 0===o&&(o=setTimeout(h,t)),a}return t=m(t)||0,y(n)&&(u=!!n.leading,r=(b="maxWait"in n)?d(m(n.maxWait)||0,t):r,v="trailing"in n?!!n.trailing:v),w.cancel=function(){void 0!==o&&clearTimeout(o),c=0,l=s=i=o=void 0},w.flush=function(){return void 0===o?a:_(f())},w}}).call(this,n(1))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t);n(0);const l={android:()=>navigator.userAgent.match(/Android/i),blackberry:()=>navigator.userAgent.match(/BlackBerry/i),ios:()=>navigator.userAgent.match(/iPhone|iPad|iPod/i),opera:()=>navigator.userAgent.match(/Opera Mini/i),windows:()=>navigator.userAgent.match(/IEMobile/i),any:()=>l.android()||l.blackberry()||l.ios()||l.opera()||l.windows()};var i=l;function r(){(function(e,t=document){return[...t.querySelectorAll(e)]})("[target='_blank']").forEach(e=>e.setAttribute("rel","noopener"))}d3.select("body");var a={get:function(e){const t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp(`[\\?&]${t}=([^&#]*)`).exec(window.location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},set:function(e,t){const n=[window.location.protocol,"//",window.location.host,window.location.pathname].join(""),l=document.location.search,i=`${e}=${t}`;let r="?"+i;if(l){const n=new RegExp(`([?&])${e}[^&]*`),a=new RegExp(`([?&])${e}=[^&;]+[&;]?`);null==t||""===t?(r=l.replace(a,"$1"),r=r.replace(/[&;]$/,"")):r=null!==l.match(n)?l.replace(n,"$1"+i):`${l}&${i}`}r="?"===r?"":r,window.history.replaceState({},"",`${n}${r}`)}};let o={201801:{style:"cjbmy3c7r39vn2sqd7o070b3p"},201806:{style:"cjhqxa1mp2fbk2rphmmwonf3s"}},s="cjhqxa1mp2fbk2rphmmwonf3s",c=201806;var u;let d;var p,f,y,m=!1,b=d3.format(",.0f"),v=!1,g=d3.select(".start-button"),k=d3.select(".info-modal"),x=d3.select(".start-modal"),h=(k.select(".info-modal-close").on("click",(function(e){k.classed("info-modal-visible",!1)})),d3.select(".map-tool-tip")),w=h.select(".map-tool-tip-geo"),O=d3.select(".top-toolbar").on("mouseenter",(function(e){h.style("display",null),v=!1})),j=d3.scaleLinear().domain([0,1]).range([.85,.99]),S=!1,T=d3.select(".top-toolbar-volume"),P=d3.select(".top-toolbar-search-box"),L=P.select("input"),I=P.select(".top-toolbar-search-box-results"),M=d3.select(".tool-bar-right").on("mouseenter",(function(e){d3.select(this).style("right","0px"),M.select(".tool-bar-right-title-vert").style("display","none"),h.style("display",null),v=!1})).on("mouseleave",(function(e){d3.select(this).style("right",null),M.select(".tool-bar-right-title-vert").style("display",null)})),A=d3.select(".top-toolbar-song-wrapper"),$=A.select(".top-toolbar-song-title"),F=A.select(".top-toolbar-song-artist"),z=d3.select(".top-toolbar-song-pause-play"),B="",E="",R="",N=d3.select(".song-filter");function V(e){var t=d3.select(".player-fixed");null!=p&&(p.remove(),t.selectAll("iframe").remove(),t.selectAll("div").remove(),clearInterval(d)),p=new mapboxgl.Map({container:"map",zoom:3,style:"mapbox://styles/dock4242/"+o[e].style,hash:!1,attributionControl:!1});var n="bottom-right";y&&f<575&&(n="top-right"),p.addControl(new mapboxgl.NavigationControl,n);console.log(e),d3.csv("assets/data/geo_info.csv",(function(n){d3.csv("assets/data/"+e+"/track_info.csv",(function(l){d3.csv("assets/data/"+e+"/city_data.csv",(function(i){d3.csv("assets/data/"+e+"/country_data.csv",(function(e){d3.csv("assets/data/a1.csv",(function(r){d3.csv("assets/data/a0.csv",(function(a){var o=d3.map(n,(function(e){return e.longitude+e.latitude})),s=d3.map(l,(function(e){return e.track_link})),c=d3.map(l,(function(e){return e.track_name})),f=e[Math.round(Math.random()*e.length)];p.setCenter([f.longitude,f.latitude]);var k=d3.map(r,(function(e){return e.id})),P=d3.map(a,(function(e){return e.id})),A=[{line:"red",fill:"rgb(20,255,56)",label:"rgb(45,98,53)"},{line:"red",fill:"rgb(130,20,255)",label:"rgb(88,29,154)"},{line:"red",fill:"rgb(0,34,255)",label:"rgb(57,113,154)"},{line:"red",fill:"rgb(255,0,0)",label:"rgb(143,10,10)"},{line:"red",fill:"rgb(255,153,20)",label:"rgb(236,135,4)"},{line:"red",fill:"rgb(255,20,196)",label:"rgb(193,31,153)"},{line:"red",fill:"rgb(255,192,20)",label:"rgb(170,131,24)"},{line:"red",fill:"rgb(179,19,190)",label:"rgb(171,17,182)"},{line:"red",fill:"rgb(255,235,20)",label:"rgb(171,17,182)"}],V=["#ff7f0e","#9467bd","#98df8a","#1f77b4","#9edae5","#f7b6d2","#c5b0d5","#d62728","#bcbd22","#ff9896","#dbdb8d","#ffbb78","#2ca02c","#e377c2","#c49c94","#17becf","#8c564b","#aec7e8"];V=V.concat(d3.schemePastel2).concat(d3.schemePastel2),A=V.map((function(e){return{label:e,fill:e}}));var q=d3.nest().key((function(e){return e.track_name})).rollup((function(e){return e.length})).entries(i).sort((function(e,t){return t.value-e.value}));q=q.map((function(e){return e.key}));var J=A.map((function(e,t){return[q[t],d3.color(e.fill).darker().toString()]}));M.select(".tool-bar-right-songs").selectAll("div").remove();var C=M.select(".tool-bar-right-songs").selectAll("div").data(J.slice(0,15)).enter().append("div").attr("class","tool-bar-right-songs-song-wrapper");C.append("div").attr("class","tool-bar-right-songs-song-circle").style("border-color",(function(e){return e[1]})).style("background-color",(function(e){let t=d3.hsl(e[1]);return t.l=j(t.l),t=t.toString(),t})),C.append("p").attr("class","tool-bar-right-songs-song-text").text((function(e,t){return t+1+". "+e[0]}));var W=J.length,Y=d3.scaleLinear().domain([W,q.length-1]).range(["#929292","#f6f6f4"]),D=e.map((function(e){var t;return t=q.slice(0,W).indexOf(e.track_name)>-1?A[q.slice(0,W).indexOf(e.track_name)].fill:Y(q.indexOf(e.track_name)),(t=d3.hsl(t)).l=j(t.l),t=t.toString(),[e.iso,t]})),U=e.map((function(e){var t;return t=q.slice(0,W).indexOf(e.track_name)>-1?A[q.slice(0,W).indexOf(e.track_name)].label:Y(q.indexOf(e.track_name)),[e.iso,t]})),X=e.map((function(e){return{key:e.iso,value:e.track_name}}));console.log(X);var G=d3.nest().key((function(e){return e.boundaries_admin_1})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),Z=d3.map(G,(function(e){return e.key})),H=d3.nest().key((function(e){return e.boundaries_admin_2})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),Q=d3.nest().key((function(e){return e.boundaries_admin_3})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),K=d3.nest().key((function(e){return e.boundaries_admin_4})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),ee=d3.nest().key((function(e){return e.boundaries_admin_5})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),te=d3.nest().key((function(e){return e.boundaries_postal_1})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),ne=d3.nest().key((function(e){return e.boundaries_postal_2})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),le=G.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].label:Y(q.indexOf(e.value)),[e.key,t]})),ie=G.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].fill:Y(q.indexOf(e.value)),(t=d3.hsl(t)).l=j(t.l),t=t.toString(),[e.key,t]})),re=(H.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].label:Y(q.indexOf(e.value)),[e.key,t]})),H.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].fill:Y(q.indexOf(e.value)),(t=d3.hsl(t)).l=j(t.l),t=t.toString(),[e.key,t]})),Q.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]})),K.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]})),ee.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]})),te.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].fill:Y(q.indexOf(e.value)),(t=d3.hsl(t)).l=j(t.l),t=t.toString(),[e.key,t]}))),ae=te.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]}));ne.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]})),ne.map((function(e){var t;return t=q.slice(0,W).indexOf(e.value)>-1?A[q.slice(0,W).indexOf(e.value)].fill:Y(q.indexOf(e.value)),(t=d3.hsl(t)).l=j(t.l),t=t.toString(),[e.key,t]}));function oe(){console.log("style loaded");p.addSource("admin-0",{type:"vector",url:"mapbox://mapbox.enterprise-boundaries-a0-v1"}),p.addSource("admin-1",{type:"vector",url:"mapbox://mapbox.enterprise-boundaries-a1-v1"}),p.addSource("postal-1",{type:"vector",url:"mapbox://mapbox.enterprise-boundaries-p1-v1"});p.addLayer({id:"admin-0-fill",type:"fill",source:"admin-0",maxzoom:6,"source-layer":"boundaries_admin_0",paint:{"fill-outline-color":"rgba(0,0,0,0)","fill-opacity":1,"fill-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:D}}},"city-dots-2");var e=["in","id"].concat(G.map((function(e){return e.key})));p.addLayer({id:"admin-1-fill",type:"fill",filter:e,maxzoom:6,source:"admin-1","source-layer":"boundaries_admin_1",paint:{"fill-outline-color":"rgba(0,0,0,0)","fill-opacity":1,"fill-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:ie}}},"city-dots-2"),p.addLayer({id:"postal-1-fill",maxzoom:6,type:"fill",source:"postal-1","source-layer":"boundaries_postal_1",paint:{"fill-outline-color":"rgba(0,0,0,0)","fill-opacity":1,"fill-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:re}}},"city-dots-2"),p.addLayer({id:"country-borders-bg",type:"line",source:"admin-0","source-layer":"boundaries_admin_0",paint:{"line-width":["interpolate",["linear"],["zoom"],2,1,6,8],"line-opacity":.2,"line-blur":0,"line-color":"rgb(214,214,214)"}},"city-dots-2"),p.addLayer({id:"postal-1-lines",type:"line",source:"postal-1","source-layer":"boundaries_postal_1",paint:{"line-opacity":.1,"line-blur":0,"line-width":1,"line-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:ae}}},"city-dots-2"),p.addLayer({id:"admin-0-lines",type:"line",source:"admin-0","source-layer":"boundaries_admin_0",paint:{"line-opacity":.2,"line-blur":0,"line-width":1,"line-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:U}}},"city-dots-2"),p.addLayer({id:"admin-0-lines-background",type:"line",source:"admin-0",filter:["in","id","XX"],maxzoom:6,"source-layer":"boundaries_admin_0",paint:{"line-width":["interpolate",["linear"],["zoom"],2,1,8,5],"line-opacity":.5,"line-blur":0,"line-color":"rgb(100,100,100)"}},"city-dots-2"),p.addLayer({id:"admin-1-lines",type:"line",source:"admin-1","source-layer":"boundaries_admin_1",paint:{"line-blur":0,"line-width":1,"line-opacity":.2,"line-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:le}}},"city-dots-2");var l=["country-label","major-city-label-2","minor-city-label-2","medium-city-label-2"];for(var i in l)p.setPaintProperty(l[i],"text-color",{base:"rgb(29,27,27)",stops:J,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"});p.setLayoutProperty("city-dots-2","visibility","visible"),p.setPaintProperty("city-dots-2","circle-color",{base:"rgb(29,27,27)",stops:J,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"}),p.setPaintProperty("city-dots-2","circle-stroke-color",{base:"rgb(29,27,27)",stops:J,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"}),p.setLayerZoomRange("city-dots-2",6,24);d3.select(".player-button").on("click",(function(e){u.pauseVideo()})),d3.select("body").on("mousemove",(function(e){var t=d3.mouse(this);h.style("transform","translate("+(t[0]+50)+"px,"+t[1]+"px)")}));var r=d3.select(".player-track-info"),a=r.select(".player-track-info-track-wrapper"),d=(a.select(".player-track-info-track"),a.select(".player-track-info-artist"),r.select(".player-track-info-stats-wrapper").select(".player-track-info-stats-local"),!1);p.on("movestart",(function(e){Q(),d||t.classed("player-fixed-moved",!1).style("top",null).style("left",null);S||N.style("transform","none")}));p.getStyle().layers[p.getStyle().layers.length-1].id;var j=p.getFilter("major-city-label-2"),M=p.getFilter("minor-city-label-2"),A=p.getFilter("medium-city-label-2");y||p.on("mousemove",(function(e){0==v&&(h.style("display","block"),v=!0);var t=p.queryRenderedFeatures(e.point,{layers:["admin-0-fill"]}),n=!1;t.length>0&&(n=r=t[0].properties.id,p.setFilter("admin-0-lines-background",["in","id",r]));var i=p.queryRenderedFeatures(e.point,{layers:l});if(p.getCanvas().style.cursor=i.length?"pointer":"",i.length>0){var r=i[0].properties;h.style("display","block"),w.html("<span>"+r.track_name+"</span><br>"+o.get(JSON.stringify(r.longitude)+JSON.stringify(r.latitude)).geo_name+" - "+b(r.views)+" views")}else{var a=p.queryRenderedFeatures(e.point,{layers:["admin-1-fill"]});if(a.length>0){h.style("display","block");r=k.get(a[0].properties.id);w.text(r.name+", "+P.get(r.country_code).name)}else n?(h.style("display","block"),w.text(P.get(n).name)):(w.text(""),h.style("display",null))}}));var V=!1;function q(){H(),N.style("transform",null),$.text((function(e){return B.length>15?B.slice(0,12)+"...":B})),F.text(E),oe.text("#1 in "+R+" - "+B)}p.on("click",(function(e){console.log("clicking");var n=p.queryRenderedFeatures(e.point,{layers:["medium-city-label-2","country-label","major-city-label-2","minor-city-label-2"]});if(n.length>0&&0==V){console.log("clicking here");var l=n[0].properties;console.log(l);var i=l.track_link.replace("https://www.youtube.com/watch?v=","");W.setLngLat([l.longitude,l.latitude]),y||t.classed("player-fixed-moved",!0),B=l.track_name,E=s.get(i).artist_name;var r=JSON.stringify(l.longitude)+JSON.stringify(l.latitude);R=o.get(r).geo_name,p.flyTo({center:[l.longitude,l.latitude]}),d=!0,p.once("moveend",(function(e){y||t.classed("player-fixed-moved",!0).style("top",W._pos.y+"px").style("left",W._pos.x+"px"),d=!1})),y?u.cueVideoById(i):u.loadVideoById(i),q()}else if(0==V){var a=e.lngLat,f=p.queryRenderedFeatures(e.point,{layers:["admin-1-fill"]});if(f.length>0){var m=f[0].properties,b=Z.get(m.id).value;i=(l=c.get(b)).track_link.replace("https://www.youtube.com/watch?v=","");W.setLngLat([a.lng,a.lat]),B=l.track_name,E=s.get(i).artist_name;var v=k.get(m.id);R=v.name,p.flyTo({center:[a.lng,a.lat]}),p.once("moveend",(function(e){y||t.classed("player-fixed-moved",!0).style("top",W._pos.y+"px").style("left",W._pos.x+"px"),d=!1})),y?u.cueVideoById(i):u.loadVideoById(i),q()}}}));var W=new mapboxgl.Marker(d3.select("#music-marker").node()).setLngLat([f.longitude,f.latitude]).addTo(p),Y=d3.select("#music-marker");function H(){Y.select("#player").style("display",null),ne.style("display",null),oe.style("display",null),t.style("display",null),ee.style("display",null)}function Q(){Y.select("#player").style("display","none"),y||ne.style("display","none")}Y.select("svg").on("click",(function(e){V=!0,H(),setTimeout((function(){V=!1}),500)}));var K=f.track_link.replace("https://www.youtube.com/watch?v=",""),ee=(t.append("iframe").attr("id","player").attr("src","https://www.youtube.com/embed/"+K+"?enablejsapi=1&amp;enablejsapi=true&amp;playsinline=1&autoplay=0").attr("frameborder","0").property("allowfullscreen",!0),t.append("div").attr("class","player-elements")),ne=ee.append("div").attr("class","music-marker-close").text("×").on("click",(function(e){V=!0,H(),setTimeout((function(){V=!1}),500),Q(),t.classed("player-fixed-moved",!1).style("top",null).style("left",null),y&&(t.style("display","none"),ee.style("display","none"))})),oe=ee.append("div").attr("class","music-marker-text").text("#1 in "),se="267";function ce(e){var t=["country-label","major-city-label-2","minor-city-label-2","medium-city-label-2","city-dots-2"],n={"country-label":null,"major-city-label-2":j,"minor-city-label-2":M,"medium-city-label-2":A,"city-dots-2":null};for(var l in t)S?n[t[l]]?p.setFilter(t[l],["all",n[t[l]],["==","track_name",e]]):p.setFilter(t[l],["==","track_name",e]):p.setFilter(t[l],n[t[l]]);var i=["admin-0-fill","admin-1-fill","postal-1-fill","admin-0-lines","admin-1-lines","postal-1-lines"],r={"admin-0-fill":X,"admin-1-fill":G,"postal-1-fill":te,"admin-0-lines":X,"admin-1-lines":G,"postal-1-lines":te};for(var l in i)if(S){var a=r[i[l]].filter((function(t){return t.value==e})).map((function(e){return e.key}));p.setFilter(i[l],["in","id"].concat(a))}else p.setFilter(i[l],null)}function ue(){!function(e){if(e.length>2){I.style("display","block"),I.selectAll("p").remove();var t=new RegExp("\\b"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i"),l=[];l=(l=_.filter(n,(function(e,n){return t.test(e.geo_name)}))).slice(0,5),I.selectAll("p").data(l).enter().append("p").attr("class","top-toolbar-search-box-results-result").text((function(e){return e.geo_name+", "+e.country_code})).on("click",(function(e){I.style("display",null);var t=8;""==e.geonameid&&(t=5),p.flyTo({center:[e.longitude,e.latitude],zoom:t})})),l.length}else I.style("display",null)}(this.value.trim())}function de(){m=!0;var e=f.track_link.replace("https://www.youtube.com/watch?v=","");g.select(".start-button-play-text").text("Play #1 In "+f.country_name),g.select(".start-button-play-icon").style("display","block");function n(){var t=["country-label","major-city-label-2","minor-city-label-2","medium-city-label-2"];for(var n in t)p.setLayoutProperty(t[n],"visibility","visible");Y.select("#player").style("visibility","visible"),ne.style("visibility","visible"),oe.style("visibility","visible"),N.style("visibility","visible"),O.style("visibility","visible"),h.style("visibility","visible"),H(),y||h.style("display","block"),v=!0,y||u.loadVideoById(e),oe.text("#1 in "+f.country_name+" - "+f.track_name),!0,$.text((function(e){return f.track_name.length>15?f.track_name.slice(0,12)+"...":f.track_name})),F.text(f.artist_name),B=f.track_name,E=f.artist_name,R=f.country_name}p.flyTo({zoom:6}),g.style("pointer-events","all").on("click",(function(e){p.flyTo({zoom:3}),p.once("moveend",(function(e){y||t.classed("player-fixed-moved",!0).style("top",W._pos.y+"px").style("left",W._pos.x+"px"),d=!1})),x.transition().duration(500).style("opacity",0).on("end",(function(e){x.style("display","none"),n()}))})),"none"==x.style("display")&&(p.flyTo({zoom:3}),p.once("moveend",(function(e){y||t.classed("player-fixed-moved",!0).style("top",W._pos.y+"px").style("left",W._pos.x+"px"),d=!1})),n())}y&&(se="267"),u=new YT.Player("player",{height:"100%",width:se,events:{onReady:function(e){L.on("keyup",ue);var t=f.track_link.replace("https://www.youtube.com/watch?v=","");y||de();N.on("click",(function(e){d3.select(this).select(".song-filter-box").property("checked")?(S=!1,d3.select(this).select(".song-filter-box").property("checked",!1)):(d3.select(this).select(".song-filter-box").property("checked",!0),S=!0),ce(B)})),C.on("click",(function(e){if(d3.select(this).classed("right-song-selected"))S=!1,d3.select(this).classed("right-song-selected",!1),ce(e[0]);else{C.classed("right-song-selected",!1),S=!0,d3.select(this).classed("right-song-selected",!0),ce(e[0]),p.flyTo({center:[1.873,18.301],zoom:1.2}),B=d3.select(this).datum()[0],E=c.get(d3.select(this).datum()[0]).artist_name;var t=c.get(d3.select(this).datum()[0]).track_link;t&&u.loadVideoById(t),N.style("transform",null),$.text((function(e){return B.length>15?B.slice(0,12)+"...":B})),F.text(E),oe.text("")}})),T.on("click",(function(e){d3.select(this).classed("muted")?(d3.select(this).classed("muted",!1),u.unMute()):(d3.select(this).classed("muted",!0),u.mute())})),z.classed("paused",!0).on("click",(function(e){d3.select(this).classed("paused")?(d3.select(this).classed("paused",!1),u.pauseVideo()):(d3.select(this).classed("paused",!0),u.playVideo())})),y&&u.cueVideoById(t)},onStateChange:function(e){y&&5==e.data&&!m&&de()}},enablejsapi:!0,fs:0,playsinline:1})}d=window.setInterval((function(e,t){p.loaded()&&(oe(),clearInterval(d))}),500)}))}))}))}))}))}))}N.style("transform","none"),window.onYouTubeIframeAPIReady=function(){mapboxgl.accessToken="pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2trOXV2MW9zMDExbTJvczFydTkxOTJvMiJ9.7qeHgJkUfxOaWEYtBGNU9w",mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",null,!0),V(c)};var q={init:function(){let e=a.get("date");""==e&&(e="201806",a.set("date","201806")),c=e,s=o[c].style,d3.select(".top-toolbar-title-text").select("select").selectAll("option").property("selected",(function(e){return d3.select(this).property("value")===c})),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(y=!0),f=Math.max(document.documentElement.clientWidth,window.innerWidth||0),d3.select(".top-toolbar-info").on("click",(function(e){k.classed("info-modal-visible")?k.classed("info-modal-visible",!1):k.classed("info-modal-visible",!0)})),d3.select(".top-toolbar-title-text").select("select").on("change",(function(e){var t=d3.select(this).property("value");a.set("date",t),V(t)}));var t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},resize:function(){}};const J=d3.select("body");r(),J.classed("is-mobile",i.any()),q.init()}]);