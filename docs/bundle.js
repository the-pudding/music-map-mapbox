!function(e){var t={};function n(l){if(t[l])return t[l].exports;var i=t[l]={i:l,l:!1,exports:{}};return e[l].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,l){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(l,i,function(t){return e[t]}.bind(null,i));return l},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){(function(t){var n=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,r=/^0o[0-7]+$/i,a=parseInt,o="object"==typeof t&&t&&t.Object===Object&&t,s="object"==typeof self&&self&&self.Object===Object&&self,c=o||s||Function("return this")(),u=Object.prototype.toString,d=Math.max,f=Math.min,p=function(){return c.Date.now()};function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function m(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return NaN;if(y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var o=i.test(e);return o||r.test(e)?a(e.slice(2),o?2:8):l.test(e)?NaN:+e}e.exports=function(e,t,n){var l,i,r,a,o,s,c=0,u=!1,b=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var n=l,r=i;return l=i=void 0,c=t,a=e.apply(r,n)}function k(e){return c=e,o=setTimeout(h,t),u?g(e):a}function x(e){var n=e-s;return void 0===s||n>=t||n<0||b&&e-c>=r}function h(){var e=p();if(x(e))return _(e);o=setTimeout(h,function(e){var n=t-(e-s);return b?f(n,r-(e-c)):n}(e))}function _(e){return o=void 0,v&&l?g(e):(l=i=void 0,a)}function w(){var e=p(),n=x(e);if(l=arguments,i=this,s=e,n){if(void 0===o)return k(s);if(b)return o=setTimeout(h,t),g(s)}return void 0===o&&(o=setTimeout(h,t)),a}return t=m(t)||0,y(n)&&(u=!!n.leading,r=(b="maxWait"in n)?d(m(n.maxWait)||0,t):r,v="trailing"in n?!!n.trailing:v),w.cancel=function(){void 0!==o&&clearTimeout(o),c=0,l=s=i=o=void 0},w.flush=function(){return void 0===o?a:_(p())},w}}).call(this,n(1))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t);n(0);const l={android:()=>navigator.userAgent.match(/Android/i),blackberry:()=>navigator.userAgent.match(/BlackBerry/i),ios:()=>navigator.userAgent.match(/iPhone|iPad|iPod/i),opera:()=>navigator.userAgent.match(/Opera Mini/i),windows:()=>navigator.userAgent.match(/IEMobile/i),any:()=>l.android()||l.blackberry()||l.ios()||l.opera()||l.windows()};var i=l;function r(){(function(e,t=document){return[...t.querySelectorAll(e)]})("[target='_blank']").forEach(e=>e.setAttribute("rel","noopener"))}d3.select("body");var a,o,s,c,u=!1,d=d3.format(",.0f"),f=!1,p=d3.select(".start-button"),y=d3.select(".info-modal"),m=d3.select(".start-modal"),b=(y.select(".info-modal-close").on("click",(function(e){y.classed("info-modal-visible",!1)})),d3.select(".map-tool-tip")),v=b.select(".map-tool-tip-geo"),g=d3.select(".top-toolbar").on("mouseenter",(function(e){b.style("display",null),f=!1})),k=d3.scaleLinear().domain([0,1]).range([.85,.99]),x=!1,h=d3.select(".top-toolbar-volume"),w=d3.select(".top-toolbar-search-box"),O=w.select("input"),j=w.select(".top-toolbar-search-box-results"),S=d3.select(".tool-bar-right").on("mouseenter",(function(e){d3.select(this).style("right","0px"),S.select(".tool-bar-right-title-vert").style("display","none"),b.style("display",null),f=!1})).on("mouseleave",(function(e){d3.select(this).style("right",null),S.select(".tool-bar-right-title-vert").style("display",null)})),T=d3.select(".top-toolbar-song-wrapper"),P=T.select(".top-toolbar-song-title"),L=T.select(".top-toolbar-song-artist"),M=d3.select(".top-toolbar-song-pause-play"),F="",I="",z="",A=d3.select(".song-filter");A.style("transform","none"),window.onYouTubeIframeAPIReady=function(){d3.csv("assets/data/geo_info.csv",(function(e){d3.csv("assets/data/track_info.csv",(function(t){d3.csv("assets/data/city_data_new.csv",(function(n){d3.csv("assets/data/country_data.csv",(function(l){d3.csv("assets/data/a1.csv",(function(i){d3.csv("assets/data/a0.csv",(function(r){var y=d3.map(e,(function(e){return e.longitude+e.latitude})),w=d3.map(t,(function(e){return e.track_link})),T=d3.map(t,(function(e){return e.track_name})),B=l[Math.round(Math.random()*l.length)];mapboxgl.accessToken="pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2trOXV2MW9zMDExbTJvczFydTkxOTJvMiJ9.7qeHgJkUfxOaWEYtBGNU9w",mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",null,!0),o=new mapboxgl.Map({container:"map",zoom:3,center:[B.longitude,B.latitude],style:"mapbox://styles/dock4242/cjhqxa1mp2fbk2rphmmwonf3s",hash:!1,attributionControl:!1});var N="bottom-right";c&&s<575&&(N="top-right"),o.addControl(new mapboxgl.NavigationControl,N);var E=d3.map(i,(function(e){return e.id})),V=d3.map(r,(function(e){return e.id})),J=[{line:"red",fill:"rgb(20,255,56)",label:"rgb(45,98,53)"},{line:"red",fill:"rgb(130,20,255)",label:"rgb(88,29,154)"},{line:"red",fill:"rgb(0,34,255)",label:"rgb(57,113,154)"},{line:"red",fill:"rgb(255,0,0)",label:"rgb(143,10,10)"},{line:"red",fill:"rgb(255,153,20)",label:"rgb(236,135,4)"},{line:"red",fill:"rgb(255,20,196)",label:"rgb(193,31,153)"},{line:"red",fill:"rgb(255,192,20)",label:"rgb(170,131,24)"},{line:"red",fill:"rgb(179,19,190)",label:"rgb(171,17,182)"},{line:"red",fill:"rgb(255,235,20)",label:"rgb(171,17,182)"}],R=["#ff7f0e","#9467bd","#98df8a","#1f77b4","#9edae5","#f7b6d2","#c5b0d5","#d62728","#bcbd22","#ff9896","#dbdb8d","#ffbb78","#2ca02c","#e377c2","#c49c94","#17becf","#8c564b","#aec7e8"];R=R.concat(d3.schemePastel2).concat(d3.schemePastel2),J=R.map((function(e){return{label:e,fill:e}}));var q=d3.nest().key((function(e){return e.track_name})).rollup((function(e){return e.length})).entries(n).sort((function(e,t){return t.value-e.value}));q=q.map((function(e){return e.key}));var C=J.map((function(e,t){return[q[t],d3.color(e.fill).darker().toString()]})),W=S.select(".tool-bar-right-songs").selectAll("div").data(C.slice(0,15)).enter().append("div").attr("class","tool-bar-right-songs-song-wrapper");W.append("div").attr("class","tool-bar-right-songs-song-circle").style("border-color",(function(e){return e[1]})).style("background-color",(function(e){let t=d3.hsl(e[1]);return t.l=k(t.l),t=t.toString(),t})),W.append("p").attr("class","tool-bar-right-songs-song-text").text((function(e,t){return t+1+". "+e[0]}));var $=C.length,Y=d3.scaleLinear().domain([$,q.length-1]).range(["#929292","#f6f6f4"]),D=l.map((function(e){var t;return t=q.slice(0,$).indexOf(e.track_name)>-1?J[q.slice(0,$).indexOf(e.track_name)].fill:Y(q.indexOf(e.track_name)),(t=d3.hsl(t)).l=k(t.l),t=t.toString(),[e.iso,t]})),X=l.map((function(e){var t;return t=q.slice(0,$).indexOf(e.track_name)>-1?J[q.slice(0,$).indexOf(e.track_name)].label:Y(q.indexOf(e.track_name)),[e.iso,t]})),G=l.map((function(e){return{key:e.iso,value:e.track_name}})),U=d3.nest().key((function(e){return e.boundaries_admin_1})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(n),Z=d3.map(U,(function(e){return e.key})),H=d3.nest().key((function(e){return e.boundaries_admin_2})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(n),Q=d3.nest().key((function(e){return e.boundaries_admin_3})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(n),K=d3.nest().key((function(e){return e.boundaries_admin_4})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(n),ee=d3.nest().key((function(e){return e.boundaries_admin_5})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(n),te=d3.nest().key((function(e){return e.boundaries_postal_1})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(n),ne=d3.nest().key((function(e){return e.boundaries_postal_2})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(n),le=U.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].label:Y(q.indexOf(e.value)),[e.key,t]})),ie=U.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].fill:Y(q.indexOf(e.value)),(t=d3.hsl(t)).l=k(t.l),t=t.toString(),[e.key,t]})),re=(H.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].label:Y(q.indexOf(e.value)),[e.key,t]})),H.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].fill:Y(q.indexOf(e.value)),(t=d3.hsl(t)).l=k(t.l),t=t.toString(),[e.key,t]})),Q.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]})),K.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]})),ee.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]})),te.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].fill:Y(q.indexOf(e.value)),(t=d3.hsl(t)).l=k(t.l),t=t.toString(),[e.key,t]}))),ae=te.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]}));ne.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].fill:Y(q.indexOf(e.value)),[e.key,t]})),ne.map((function(e){var t;return t=q.slice(0,$).indexOf(e.value)>-1?J[q.slice(0,$).indexOf(e.value)].fill:Y(q.indexOf(e.value)),(t=d3.hsl(t)).l=k(t.l),t=t.toString(),[e.key,t]}));o.on("load",(function(){o.addSource("admin-0",{type:"vector",url:"mapbox://mapbox.enterprise-boundaries-a0-v1"}),o.addSource("admin-1",{type:"vector",url:"mapbox://mapbox.enterprise-boundaries-a1-v1"}),o.addSource("postal-1",{type:"vector",url:"mapbox://mapbox.enterprise-boundaries-p1-v1"});o.addLayer({id:"admin-0-fill",type:"fill",source:"admin-0",maxzoom:6,"source-layer":"boundaries_admin_0",paint:{"fill-outline-color":"rgba(0,0,0,0)","fill-opacity":1,"fill-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:D}}},"city-dots-2");var t=["in","id"].concat(U.map((function(e){return e.key})));o.addLayer({id:"admin-1-fill",type:"fill",filter:t,maxzoom:6,source:"admin-1","source-layer":"boundaries_admin_1",paint:{"fill-outline-color":"rgba(0,0,0,0)","fill-opacity":1,"fill-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:ie}}},"city-dots-2"),o.addLayer({id:"postal-1-fill",maxzoom:6,type:"fill",source:"postal-1","source-layer":"boundaries_postal_1",paint:{"fill-outline-color":"rgba(0,0,0,0)","fill-opacity":1,"fill-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:re}}},"city-dots-2"),o.addLayer({id:"country-borders-bg",type:"line",source:"admin-0","source-layer":"boundaries_admin_0",paint:{"line-width":["interpolate",["linear"],["zoom"],2,1,6,8],"line-opacity":.2,"line-blur":0,"line-color":"rgb(214,214,214)"}},"city-dots-2"),o.addLayer({id:"postal-1-lines",type:"line",source:"postal-1","source-layer":"boundaries_postal_1",paint:{"line-opacity":.1,"line-blur":0,"line-width":1,"line-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:ae}}},"city-dots-2"),o.addLayer({id:"admin-0-lines",type:"line",source:"admin-0","source-layer":"boundaries_admin_0",paint:{"line-opacity":.2,"line-blur":0,"line-width":1,"line-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:X}}},"city-dots-2"),o.addLayer({id:"admin-0-lines-background",type:"line",source:"admin-0",filter:["in","id","XX"],maxzoom:6,"source-layer":"boundaries_admin_0",paint:{"line-width":["interpolate",["linear"],["zoom"],2,1,8,5],"line-opacity":.5,"line-blur":0,"line-color":"rgb(100,100,100)"}},"city-dots-2"),o.addLayer({id:"admin-1-lines",type:"line",source:"admin-1","source-layer":"boundaries_admin_1",paint:{"line-blur":0,"line-width":1,"line-opacity":.2,"line-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:le}}},"city-dots-2");var n=["country-label","major-city-label-2","minor-city-label-2","medium-city-label-2"];for(var l in n)o.setPaintProperty(n[l],"text-color",{base:"rgb(29,27,27)",stops:C,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"});o.setLayoutProperty("city-dots-2","visibility","visible"),o.setPaintProperty("city-dots-2","circle-color",{base:"rgb(29,27,27)",stops:C,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"}),o.setPaintProperty("city-dots-2","circle-stroke-color",{base:"rgb(29,27,27)",stops:C,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"}),o.setLayerZoomRange("city-dots-2",6,24);d3.select(".player-button").on("click",(function(e){a.pauseVideo()})),d3.select("body").on("mousemove",(function(e){var t=d3.mouse(this);b.style("transform","translate("+(t[0]+50)+"px,"+t[1]+"px)")}));var i=d3.select(".player-track-info"),r=i.select(".player-track-info-track-wrapper"),s=(r.select(".player-track-info-track"),r.select(".player-track-info-artist"),i.select(".player-track-info-stats-wrapper").select(".player-track-info-stats-local"),!1);o.on("movestart",(function(e){H(),s||K.classed("player-fixed-moved",!1).style("top",null).style("left",null);x||A.style("transform","none")}));o.getStyle().layers[o.getStyle().layers.length-1].id;var k=o.getFilter("major-city-label-2"),S=o.getFilter("minor-city-label-2"),N=o.getFilter("medium-city-label-2");c||o.on("mousemove",(function(e){0==f&&(b.style("display","block"),f=!0);var t=o.queryRenderedFeatures(e.point,{layers:["admin-0-fill"]}),l=!1;t.length>0&&(l=r=t[0].properties.id,o.setFilter("admin-0-lines-background",["in","id",r]));var i=o.queryRenderedFeatures(e.point,{layers:n});if(o.getCanvas().style.cursor=i.length?"pointer":"",i.length>0){var r=i[0].properties;b.style("display","block"),v.html("<span>"+r.track_name+"</span><br>"+y.get(JSON.stringify(r.longitude)+JSON.stringify(r.latitude)).geo_name+" - "+d(r.views)+" views")}else{var a=o.queryRenderedFeatures(e.point,{layers:["admin-1-fill"]});if(a.length>0){b.style("display","block");r=E.get(a[0].properties.id);v.text(r.name+", "+V.get(r.country_code).name)}else l?(b.style("display","block"),v.text(V.get(l).name)):(v.text(""),b.style("display",null))}}));var J=!1;function R(){Y(),A.style("transform",null),P.text((function(e){return F.length>15?F.slice(0,12)+"...":F})),L.text(I),oe.text("#1 in "+z+" - "+F)}o.on("click",(function(e){var t=o.queryRenderedFeatures(e.point,{layers:["medium-city-label-2","country-label","major-city-label-2","minor-city-label-2"]});if(t.length>0&&0==J){var n=(u=t[0].properties).track_link.replace("https://www.youtube.com/watch?v=","");q.setLngLat([u.longitude,u.latitude]),c||K.classed("player-fixed-moved",!0),F=u.track_name,I=w.get(n).artist_name;var l=JSON.stringify(u.longitude)+JSON.stringify(u.latitude);z=y.get(l).geo_name,o.flyTo({center:[u.longitude,u.latitude]}),s=!0,o.once("moveend",(function(e){c||K.classed("player-fixed-moved",!0).style("top",q._pos.y+"px").style("left",q._pos.x+"px"),s=!1})),c?a.cueVideoById(n):a.loadVideoById(n),R()}else if(0==J){var i=e.lngLat,r=o.queryRenderedFeatures(e.point,{layers:["admin-1-fill"]});if(r.length>0){var u,d=r[0].properties,f=Z.get(d.id).value;n=(u=T.get(f)).track_link.replace("https://www.youtube.com/watch?v=","");q.setLngLat([i.lng,i.lat]),F=u.track_name,I=w.get(n).artist_name;var p=E.get(d.id);z=p.name,o.flyTo({center:[i.lng,i.lat]}),o.once("moveend",(function(e){c||K.classed("player-fixed-moved",!0).style("top",q._pos.y+"px").style("left",q._pos.x+"px"),s=!1})),c?a.cueVideoById(n):a.loadVideoById(n),R()}}}));var q=new mapboxgl.Marker(d3.select("#music-marker").node()).setLngLat([B.longitude,B.latitude]).addTo(o),$=d3.select("#music-marker");function Y(){$.select("#player").style("display",null),ne.style("display",null),oe.style("display",null),K.style("display",null),ee.style("display",null)}function H(){$.select("#player").style("display","none"),c||ne.style("display","none")}$.select("svg").on("click",(function(e){J=!0,Y(),setTimeout((function(){J=!1}),500)}));var Q=B.track_link.replace("https://www.youtube.com/watch?v=",""),K=d3.select(".player-fixed"),ee=(K.append("iframe").attr("id","player").attr("src","https://www.youtube.com/embed/"+Q+"?enablejsapi=1&amp;enablejsapi=true&amp;playsinline=1&autoplay=0").attr("frameborder","0").property("allowfullscreen",!0),K.append("div").attr("class","player-elements")),ne=ee.append("div").attr("class","music-marker-close").text("Ã—").on("click",(function(e){J=!0,Y(),setTimeout((function(){J=!1}),500),H(),K.classed("player-fixed-moved",!1).style("top",null).style("left",null),c&&(K.style("display","none"),ee.style("display","none"))})),oe=ee.append("div").attr("class","music-marker-text").text("#1 in "),se="267";function ce(e){var t=["country-label","major-city-label-2","minor-city-label-2","medium-city-label-2","city-dots-2"],n={"country-label":null,"major-city-label-2":k,"minor-city-label-2":S,"medium-city-label-2":N,"city-dots-2":null};for(var l in t)x?n[t[l]]?o.setFilter(t[l],["all",n[t[l]],["==","track_name",e]]):o.setFilter(t[l],["==","track_name",e]):o.setFilter(t[l],n[t[l]]);var i=["admin-0-fill","admin-1-fill","postal-1-fill","admin-0-lines","admin-1-lines","postal-1-lines"],r={"admin-0-fill":G,"admin-1-fill":U,"postal-1-fill":te,"admin-0-lines":G,"admin-1-lines":U,"postal-1-lines":te};for(var l in i)if(x){var a=r[i[l]].filter((function(t){return t.value==e})).map((function(e){return e.key}));o.setFilter(i[l],["in","id"].concat(a))}else o.setFilter(i[l],null)}function ue(){!function(t){if(t.length>2){j.style("display","block"),j.selectAll("p").remove();var n=new RegExp("\\b"+t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i"),l=[];l=(l=_.filter(e,(function(e,t){return n.test(e.geo_name)}))).slice(0,5),j.selectAll("p").data(l).enter().append("p").attr("class","top-toolbar-search-box-results-result").text((function(e){return e.geo_name+", "+e.country_code})).on("click",(function(e){j.style("display",null);var t=8;""==e.geonameid&&(t=5),o.flyTo({center:[e.longitude,e.latitude],zoom:t})})),l.length}else j.style("display",null)}(this.value.trim())}function de(){u=!0;var e=B.track_link.replace("https://www.youtube.com/watch?v=","");p.select(".start-button-play-text").text("Play #1 In "+B.country_name),p.select(".start-button-play-icon").style("display","block");o.flyTo({zoom:6}),p.style("pointer-events","all").on("click",(function(t){o.flyTo({zoom:3}),o.once("moveend",(function(e){c||K.classed("player-fixed-moved",!0).style("top",q._pos.y+"px").style("left",q._pos.x+"px"),s=!1})),m.transition().duration(500).style("opacity",0).on("end",(function(t){m.style("display","none").remove(),$.select("#player").style("visibility","visible"),ne.style("visibility","visible"),oe.style("visibility","visible"),A.style("visibility","visible"),g.style("visibility","visible"),b.style("visibility","visible"),Y(),c||b.style("display","block"),f=!0,c||a.loadVideoById(e),oe.text("#1 in "+B.country_name+" - "+B.track_name),!0,P.text((function(e){return B.track_name.length>15?B.track_name.slice(0,12)+"...":B.track_name})),L.text(B.artist_name),F=B.track_name,I=B.artist_name,z=B.country_name}));var n=["country-label","major-city-label-2","minor-city-label-2","medium-city-label-2"];for(var l in n)o.setLayoutProperty(n[l],"visibility","visible")}))}c&&(se="267"),a=new YT.Player("player",{height:"100%",width:se,events:{onReady:function(e){O.on("keyup",ue);var t=B.track_link.replace("https://www.youtube.com/watch?v=","");c||de();A.on("click",(function(e){d3.select(this).select(".song-filter-box").property("checked")?(x=!1,d3.select(this).select(".song-filter-box").property("checked",!1)):(d3.select(this).select(".song-filter-box").property("checked",!0),x=!0),ce(F)})),W.on("click",(function(e){if(d3.select(this).classed("right-song-selected"))x=!1,d3.select(this).classed("right-song-selected",!1),ce(e[0]);else{W.classed("right-song-selected",!1),x=!0,d3.select(this).classed("right-song-selected",!0),ce(e[0]),o.flyTo({center:[1.873,18.301],zoom:1.2}),F=d3.select(this).datum()[0],I=T.get(d3.select(this).datum()[0]).artist_name;var t=T.get(d3.select(this).datum()[0]).track_link;t&&a.loadVideoById(t),A.style("transform",null),P.text((function(e){return F.length>15?F.slice(0,12)+"...":F})),L.text(I),oe.text("")}})),h.on("click",(function(e){d3.select(this).classed("muted")?(d3.select(this).classed("muted",!1),a.unMute()):(d3.select(this).classed("muted",!0),a.mute())})),M.classed("paused",!0).on("click",(function(e){d3.select(this).classed("paused")?(d3.select(this).classed("paused",!1),a.pauseVideo()):(d3.select(this).classed("paused",!0),a.playVideo())})),c&&a.cueVideoById(t)},onStateChange:function(e){c&&5==e.data&&!u&&de()}},enablejsapi:!0,fs:0,playsinline:1})}))}))}))}))}))}))}))};var B={init:function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(c=!0),s=Math.max(document.documentElement.clientWidth,window.innerWidth||0),d3.select(".top-toolbar-info").on("click",(function(e){y.classed("info-modal-visible")?y.classed("info-modal-visible",!1):y.classed("info-modal-visible",!0)})),d3.select(".top-toolbar-title-text").select("select").on("change",(function(e){"dec-2017"==d3.select(this).property("value")&&(window.location.href="https://pudding.cool/2018/01/music-map")}));var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)},resize:function(){}};const N=d3.select("body");r(),N.classed("is-mobile",i.any()),B.init()}]);