!function(e){var t={};function n(l){if(t[l])return t[l].exports;var i=t[l]={i:l,l:!1,exports:{}};return e[l].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,l){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(l,i,function(t){return e[t]}.bind(null,i));return l},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){(function(t){var n=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,r=/^0o[0-7]+$/i,o=parseInt,a="object"==typeof t&&t&&t.Object===Object&&t,s="object"==typeof self&&self&&self.Object===Object&&self,c=a||s||Function("return this")(),u=Object.prototype.toString,d=Math.max,p=Math.min,f=function(){return c.Date.now()};function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function m(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return NaN;if(y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var a=i.test(e);return a||r.test(e)?o(e.slice(2),a?2:8):l.test(e)?NaN:+e}e.exports=function(e,t,n){var l,i,r,o,a,s,c=0,u=!1,b=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var n=l,r=i;return l=i=void 0,c=t,o=e.apply(r,n)}function k(e){return c=e,a=setTimeout(h,t),u?g(e):o}function x(e){var n=e-s;return void 0===s||n>=t||n<0||b&&e-c>=r}function h(){var e=f();if(x(e))return _(e);a=setTimeout(h,function(e){var n=t-(e-s);return b?p(n,r-(e-c)):n}(e))}function _(e){return a=void 0,v&&l?g(e):(l=i=void 0,o)}function w(){var e=f(),n=x(e);if(l=arguments,i=this,s=e,n){if(void 0===a)return k(s);if(b)return a=setTimeout(h,t),g(s)}return void 0===a&&(a=setTimeout(h,t)),o}return t=m(t)||0,y(n)&&(u=!!n.leading,r=(b="maxWait"in n)?d(m(n.maxWait)||0,t):r,v="trailing"in n?!!n.trailing:v),w.cancel=function(){void 0!==a&&clearTimeout(a),c=0,l=s=i=a=void 0},w.flush=function(){return void 0===a?o:_(f())},w}}).call(this,n(1))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t);n(0);const l={android:()=>navigator.userAgent.match(/Android/i),blackberry:()=>navigator.userAgent.match(/BlackBerry/i),ios:()=>navigator.userAgent.match(/iPhone|iPad|iPod/i),opera:()=>navigator.userAgent.match(/Opera Mini/i),windows:()=>navigator.userAgent.match(/IEMobile/i),any:()=>l.android()||l.blackberry()||l.ios()||l.opera()||l.windows()};var i=l;function r(){(function(e,t=document){return[...t.querySelectorAll(e)]})("[target='_blank']").forEach(e=>e.setAttribute("rel","noopener"))}d3.select("body");var o={get:function(e){const t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp(`[\\?&]${t}=([^&#]*)`).exec(window.location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},set:function(e,t){const n=[window.location.protocol,"//",window.location.host,window.location.pathname].join(""),l=document.location.search,i=`${e}=${t}`;let r="?"+i;if(l){const n=new RegExp(`([?&])${e}[^&]*`),o=new RegExp(`([?&])${e}=[^&;]+[&;]?`);null==t||""===t?(r=l.replace(o,"$1"),r=r.replace(/[&;]$/,"")):r=null!==l.match(n)?l.replace(n,"$1"+i):`${l}&${i}`}r="?"===r?"":r,window.history.replaceState({},"",`${n}${r}`)}};let a={201801:{style:"cjbmy3c7r39vn2sqd7o070b3p"},201806:{style:"cjhqxa1mp2fbk2rphmmwonf3s"},202102:{style:"ckli7pkn71acd17paqpo4k9h1"},202103:{style:"ckn0g0hiw0w4b17p9xkrptapp"},202106:{style:"ckpvpgrem0yws17ogodawlugq"}},s=null,c={},u="ckmz8449o1e7717nt72yec910",d=202106;var p;let f;var y,m,b,v=!1,g=d3.format(",.0f"),k=!1,x=d3.select(".start-button"),h=d3.select(".info-modal"),w=d3.select(".start-modal"),O=(h.select(".info-modal-close").on("click",(function(e){h.classed("info-modal-visible",!1)})),d3.select(".map-tool-tip")),j=O.select(".map-tool-tip-geo"),T=d3.select(".top-toolbar").on("mouseenter",(function(e){O.style("display",null),k=!1})),S=d3.scaleLinear().domain([0,1]).range([.85,.99]),P=!1,L=d3.select(".top-toolbar-volume"),z=d3.select(".top-toolbar-search-box"),M=z.select("input"),A=z.select(".top-toolbar-search-box-results"),I=d3.select(".tool-bar-right").on("mouseenter",(function(e){d3.select(this).style("right","0px"),I.select(".tool-bar-right-title-vert").style("display","none"),O.style("display",null),k=!1})).on("mouseleave",(function(e){d3.select(this).style("right",null),I.select(".tool-bar-right-title-vert").style("display",null)})),$=d3.select(".top-toolbar-song-wrapper"),F=$.select(".top-toolbar-song-title"),E=$.select(".top-toolbar-song-artist"),R=d3.select(".top-toolbar-song-pause-play"),N="",B="",C="",q=d3.select(".song-filter");function J(e){var t=d3.select(".player-fixed");null!=y&&(y.remove(),t.selectAll("iframe").remove(),t.selectAll("div").remove(),clearInterval(f));let n=3;Object.keys(c).length>0&&(n=c.zoom),y=new mapboxgl.Map({container:"map",zoom:n,style:"mapbox://styles/dock4242/"+a[e].style,hash:!1,attributionControl:!1});var l="bottom-right";b&&m<575&&(l="top-right"),y.addControl(new mapboxgl.NavigationControl,l);d3.csv("assets/data/geo_info.csv",(function(n){d3.csv("assets/data/"+e+"/track_info.csv",(function(l){d3.csv("assets/data/"+e+"/city_data.csv",(function(i){d3.csv("assets/data/"+e+"/country_data.csv",(function(e){d3.csv("assets/data/a1.csv",(function(r){d3.csv("assets/data/a0.csv",(function(o){var a=d3.map(n,(function(e){return e.longitude+e.latitude})),u=d3.map(l,(function(e){return e.track_link})),d=d3.map(l,(function(e){return e.track_name}));s||(s=e[Math.round(Math.random()*e.length)]),Object.keys(c).length>0?y.setCenter([c.longitude,c.latitude]):y.setCenter([s.longitude,s.latitude]);var m=d3.map(r,(function(e){return e.id})),h=d3.map(o,(function(e){return e.id})),z=[{line:"red",fill:"rgb(20,255,56)",label:"rgb(45,98,53)"},{line:"red",fill:"rgb(130,20,255)",label:"rgb(88,29,154)"},{line:"red",fill:"rgb(0,34,255)",label:"rgb(57,113,154)"},{line:"red",fill:"rgb(255,0,0)",label:"rgb(143,10,10)"},{line:"red",fill:"rgb(255,153,20)",label:"rgb(236,135,4)"},{line:"red",fill:"rgb(255,20,196)",label:"rgb(193,31,153)"},{line:"red",fill:"rgb(255,192,20)",label:"rgb(170,131,24)"},{line:"red",fill:"rgb(179,19,190)",label:"rgb(171,17,182)"},{line:"red",fill:"rgb(255,235,20)",label:"rgb(171,17,182)"}],$=["#ff7f0e","#9467bd","#98df8a","#1f77b4","#9edae5","#f7b6d2","#c5b0d5","#d62728","#bcbd22","#ff9896","#dbdb8d","#ffbb78","#2ca02c","#e377c2","#c49c94","#17becf","#8c564b","#aec7e8"];$=$.concat(d3.schemePastel2).concat(d3.schemePastel2),z=$.map((function(e){return{label:e,fill:e}}));var J=d3.nest().key((function(e){return e.track_name})).rollup((function(e){return e.length})).entries(i).sort((function(e,t){return t.value-e.value}));J=J.map((function(e){return e.key}));var V=z.map((function(e,t){return[J[t],d3.color(e.fill).darker().toString()]}));I.select(".tool-bar-right-songs").selectAll("div").remove();var W=I.select(".tool-bar-right-songs").selectAll("div").data(V.slice(0,15)).enter().append("div").attr("class","tool-bar-right-songs-song-wrapper");W.append("div").attr("class","tool-bar-right-songs-song-circle").style("border-color",(function(e){return e[1]})).style("background-color",(function(e){let t=d3.hsl(e[1]);return t.l=S(t.l),t=t.toString(),t})),W.append("p").attr("class","tool-bar-right-songs-song-text").text((function(e,t){return t+1+". "+e[0]}));var Y=V.length,Z=d3.scaleLinear().domain([Y,J.length-1]).range(["#929292","#f6f6f4"]),D=e.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.track_name)>-1?z[J.slice(0,Y).indexOf(e.track_name)].fill:Z(J.indexOf(e.track_name)),(t=d3.hsl(t)).l=S(t.l),t=t.toString(),[e.iso,t]})),U=e.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.track_name)>-1?z[J.slice(0,Y).indexOf(e.track_name)].label:Z(J.indexOf(e.track_name)),[e.iso,t]})),X=e.map((function(e){return{key:e.iso,value:e.track_name}})),G=d3.nest().key((function(e){return e.boundaries_admin_1})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),H=d3.map(G,(function(e){return e.key})),Q=d3.nest().key((function(e){return e.boundaries_admin_2})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),K=d3.nest().key((function(e){return e.boundaries_admin_3})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),ee=d3.nest().key((function(e){return e.boundaries_admin_4})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),te=d3.nest().key((function(e){return e.boundaries_admin_5})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),ne=d3.nest().key((function(e){return e.boundaries_postal_1})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),le=d3.nest().key((function(e){return e.boundaries_postal_2})).rollup((function(e){return d3.nest().key((function(e){return e.track_name})).rollup((function(e){return d3.sum(e,(function(e){return+e.views}))})).entries(e).sort((function(e,t){return+t.value-+e.value})).slice(0,1)[0].key})).entries(i),ie=G.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].label:Z(J.indexOf(e.value)),[e.key,t]})),re=G.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].fill:Z(J.indexOf(e.value)),(t=d3.hsl(t)).l=S(t.l),t=t.toString(),[e.key,t]})),oe=(Q.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].label:Z(J.indexOf(e.value)),[e.key,t]})),Q.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].fill:Z(J.indexOf(e.value)),(t=d3.hsl(t)).l=S(t.l),t=t.toString(),[e.key,t]})),K.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].fill:Z(J.indexOf(e.value)),[e.key,t]})),ee.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].fill:Z(J.indexOf(e.value)),[e.key,t]})),te.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].fill:Z(J.indexOf(e.value)),[e.key,t]})),ne.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].fill:Z(J.indexOf(e.value)),(t=d3.hsl(t)).l=S(t.l),t=t.toString(),[e.key,t]}))),ae=ne.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].fill:Z(J.indexOf(e.value)),[e.key,t]}));le.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].fill:Z(J.indexOf(e.value)),[e.key,t]})),le.map((function(e){var t;return t=J.slice(0,Y).indexOf(e.value)>-1?z[J.slice(0,Y).indexOf(e.value)].fill:Z(J.indexOf(e.value)),(t=d3.hsl(t)).l=S(t.l),t=t.toString(),[e.key,t]}));function se(){console.log("style loaded");y.addSource("admin-0",{type:"vector",url:"mapbox://mapbox.enterprise-boundaries-a0-v1"}),y.addSource("admin-1",{type:"vector",url:"mapbox://mapbox.enterprise-boundaries-a1-v1"}),y.addSource("postal-1",{type:"vector",url:"mapbox://mapbox.enterprise-boundaries-p1-v1"});y.addLayer({id:"admin-0-fill",type:"fill",source:"admin-0",maxzoom:6,"source-layer":"boundaries_admin_0",paint:{"fill-outline-color":"rgba(0,0,0,0)","fill-opacity":1,"fill-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:D}}},"city-dots-2");var e=["in","id"].concat(G.map((function(e){return e.key})));y.addLayer({id:"admin-1-fill",type:"fill",filter:e,maxzoom:6,source:"admin-1","source-layer":"boundaries_admin_1",paint:{"fill-outline-color":"rgba(0,0,0,0)","fill-opacity":1,"fill-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:re}}},"city-dots-2"),y.addLayer({id:"postal-1-fill",maxzoom:6,type:"fill",source:"postal-1","source-layer":"boundaries_postal_1",paint:{"fill-outline-color":"rgba(0,0,0,0)","fill-opacity":1,"fill-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:oe}}},"city-dots-2"),y.addLayer({id:"country-borders-bg",type:"line",source:"admin-0","source-layer":"boundaries_admin_0",paint:{"line-width":["interpolate",["linear"],["zoom"],2,1,6,8],"line-opacity":.2,"line-blur":0,"line-color":"rgb(214,214,214)"}},"city-dots-2"),y.addLayer({id:"postal-1-lines",type:"line",source:"postal-1","source-layer":"boundaries_postal_1",paint:{"line-opacity":.1,"line-blur":0,"line-width":1,"line-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:ae}}},"city-dots-2"),y.addLayer({id:"admin-0-lines",type:"line",source:"admin-0","source-layer":"boundaries_admin_0",paint:{"line-opacity":.2,"line-blur":0,"line-width":1,"line-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:U}}},"city-dots-2"),y.addLayer({id:"admin-0-lines-background",type:"line",source:"admin-0",filter:["in","id","XX"],maxzoom:6,"source-layer":"boundaries_admin_0",paint:{"line-width":["interpolate",["linear"],["zoom"],2,1,8,5],"line-opacity":.5,"line-blur":0,"line-color":"rgb(100,100,100)"}},"city-dots-2"),y.addLayer({id:"admin-1-lines",type:"line",source:"admin-1","source-layer":"boundaries_admin_1",paint:{"line-blur":0,"line-width":1,"line-opacity":.2,"line-color":{default:"rgba(0,0,0,0)",property:"id",type:"categorical",stops:ie}}},"city-dots-2");var l=["country-label","major-city-label-2","minor-city-label-2","medium-city-label-2"];for(var i in l)y.setPaintProperty(l[i],"text-color",{base:"rgb(29,27,27)",stops:V,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"});y.setLayoutProperty("city-dots-2","visibility","visible"),y.setPaintProperty("city-dots-2","circle-color",{base:"rgb(29,27,27)",stops:V,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"}),y.setPaintProperty("city-dots-2","circle-stroke-color",{base:"rgb(29,27,27)",stops:V,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"}),y.setLayerZoomRange("city-dots-2",6,24);d3.select(".player-button").on("click",(function(e){p.pauseVideo()})),d3.select("body").on("mousemove",(function(e){var t=d3.mouse(this);O.style("transform","translate("+(t[0]+50)+"px,"+t[1]+"px)")}));var r=d3.select(".player-track-info"),o=r.select(".player-track-info-track-wrapper"),f=(o.select(".player-track-info-track"),o.select(".player-track-info-artist"),r.select(".player-track-info-stats-wrapper").select(".player-track-info-stats-local"),!1);y.on("movestart",(function(e){K(),f||t.classed("player-fixed-moved",!1).style("top",null).style("left",null);P||q.style("transform","none")}));y.getStyle().layers[y.getStyle().layers.length-1].id;var S=y.getFilter("major-city-label-2"),z=y.getFilter("minor-city-label-2"),I=y.getFilter("medium-city-label-2");b||y.on("mousemove",(function(e){0==k&&(O.style("display","block"),k=!0);var t=y.queryRenderedFeatures(e.point,{layers:["admin-0-fill"]}),n=!1;t.length>0&&(n=r=t[0].properties.id,y.setFilter("admin-0-lines-background",["in","id",r]));var i=y.queryRenderedFeatures(e.point,{layers:l});if(y.getCanvas().style.cursor=i.length?"pointer":"",i.length>0){var r=i[0].properties;O.style("display","block"),j.html("<span>"+r.track_name+"</span><br>"+a.get(JSON.stringify(r.longitude)+JSON.stringify(r.latitude)).geo_name+" - "+g(r.views)+" views")}else{var o=y.queryRenderedFeatures(e.point,{layers:["admin-1-fill"]});if(o.length>0){O.style("display","block");r=m.get(o[0].properties.id);j.text(r.name+", "+h.get(r.country_code).name)}else n?(O.style("display","block"),j.text(h.get(n).name)):(j.text(""),O.style("display",null))}}));var $=!1;function J(){Q(),q.style("transform",null),F.text((function(e){return N.length>15?N.slice(0,12)+"...":N})),E.text(B),se.text("#1 in "+C+" - "+N)}y.on("click",(function(e){console.log("clicking");var n=y.queryRenderedFeatures(e.point,{layers:["medium-city-label-2","country-label","major-city-label-2","minor-city-label-2"]});if(n.length>0&&0==$){console.log("clicking here");var l=n[0].properties;console.log(l);let e=null;l.hasOwnProperty("track_link")?e=l.track_link.replace("https://www.youtube.com/watch?v=",""):l.hasOwnProperty("track_id")&&(e=l.track_id.replace("https://www.youtube.com/watch?v=","")),Y.setLngLat([l.longitude,l.latitude]),b||t.classed("player-fixed-moved",!0),N=l.track_name,B=u.get(e).artist_name;var i=JSON.stringify(l.longitude)+JSON.stringify(l.latitude);C=a.get(i).geo_name,y.flyTo({center:[l.longitude,l.latitude]}),f=!0,y.once("moveend",(function(e){b||t.classed("player-fixed-moved",!0).style("top",Y._pos.y+"px").style("left",Y._pos.x+"px"),f=!1})),p.cueVideoById(e),J()}else if(0==$){var r=e.lngLat,o=y.queryRenderedFeatures(e.point,{layers:["admin-1-fill"]});if(o.length>0){var s=o[0].properties,c=H.get(s.id).value,v=(l=d.get(c)).track_link.replace("https://www.youtube.com/watch?v=","");Y.setLngLat([r.lng,r.lat]),N=l.track_name,B=u.get(v).artist_name;var g=m.get(s.id);C=g.name,y.flyTo({center:[r.lng,r.lat]}),y.once("moveend",(function(e){b||t.classed("player-fixed-moved",!0).style("top",Y._pos.y+"px").style("left",Y._pos.x+"px"),f=!1})),p.cueVideoById(v),J()}}}));var Y=new mapboxgl.Marker(d3.select("#music-marker").node()).setLngLat([s.longitude,s.latitude]).addTo(y),Z=d3.select("#music-marker");function Q(){Z.select("#player").style("display",null),le.style("display",null),se.style("display",null),t.style("display",null),te.style("display",null)}function K(){Z.select("#player").style("display","none"),b||le.style("display","none")}Z.select("svg").on("click",(function(e){$=!0,Q(),setTimeout((function(){$=!1}),500)}));var ee=s.track_link.replace("https://www.youtube.com/watch?v=",""),te=(t.append("iframe").attr("id","player").attr("title","YouTube video of top song in country").attr("title","YouTube video of top song in country").attr("src","https://www.youtube.com/embed/"+ee+"?enablejsapi=1&amp;enablejsapi=true&amp;playsinline=1&autoplay=0&cc_load_policy=1").attr("frameborder","0").property("allowfullscreen",!0),t.append("div").attr("class","player-elements")),le=te.append("div").attr("class","music-marker-close").text("Ã—").on("click",(function(e){$=!0,Q(),setTimeout((function(){$=!1}),500),K(),t.classed("player-fixed-moved",!1).style("top",null).style("left",null),b&&(t.style("display","none"),te.style("display","none"))})),se=te.append("div").attr("class","music-marker-text").text("#1 in "),ce="267";function ue(e){var t=["country-label","major-city-label-2","minor-city-label-2","medium-city-label-2","city-dots-2"],n={"country-label":null,"major-city-label-2":S,"minor-city-label-2":z,"medium-city-label-2":I,"city-dots-2":null};for(var l in t)P?n[t[l]]?y.setFilter(t[l],["all",n[t[l]],["==","track_name",e]]):y.setFilter(t[l],["==","track_name",e]):y.setFilter(t[l],n[t[l]]);var i=["admin-0-fill","admin-1-fill","postal-1-fill","admin-0-lines","admin-1-lines","postal-1-lines"],r={"admin-0-fill":X,"admin-1-fill":G,"postal-1-fill":ne,"admin-0-lines":X,"admin-1-lines":G,"postal-1-lines":ne};for(var l in i)if(P){var o=r[i[l]].filter((function(t){return t.value==e})).map((function(e){return e.key}));y.setFilter(i[l],["in","id"].concat(o))}else y.setFilter(i[l],null)}function de(){!function(e){if(e.length>2){A.style("display","block"),A.selectAll("p").remove();var t=new RegExp("\\b"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i"),l=[];l=(l=_.filter(n,(function(e,n){return t.test(e.geo_name)}))).slice(0,5),A.selectAll("p").data(l).enter().append("p").attr("class","top-toolbar-search-box-results-result").text((function(e){return e.geo_name+", "+e.country_code})).on("click",(function(e){A.style("display",null);var t=8;""==e.geonameid&&(t=5),y.flyTo({center:[e.longitude,e.latitude],zoom:t})})),l.length}else A.style("display",null)}(this.value.trim())}function pe(){v=!0;var e=s.track_link.replace("https://www.youtube.com/watch?v=","");x.select(".start-button-play-text").text("View #1 In "+s.country_name),x.select(".start-button-play-icon").style("display","block");function n(){var t=["country-label","major-city-label-2","minor-city-label-2","medium-city-label-2"];for(var n in t)y.setLayoutProperty(t[n],"visibility","visible");Z.select("#player").style("visibility","visible"),le.style("visibility","visible"),se.style("visibility","visible"),q.style("visibility","visible"),T.style("visibility","visible"),O.style("visibility","visible"),Q(),b||O.style("display","block"),k=!0,b||p.cueVideoById(e),se.text("#1 in "+s.country_name+" - "+s.track_name),!0,F.text((function(e){return s.track_name.length>15?s.track_name.slice(0,12)+"...":s.track_name})),E.text(s.artist_name),N=s.track_name,B=s.artist_name,C=s.country_name}y.flyTo({zoom:6}),x.style("pointer-events","all").on("click",(function(e){y.flyTo({zoom:3}),y.once("moveend",(function(e){b||t.classed("player-fixed-moved",!0).style("top",Y._pos.y+"px").style("left",Y._pos.x+"px"),f=!1})),w.transition().duration(500).style("opacity",0).on("end",(function(e){w.style("display","none"),n()}))})),"none"==w.style("display")&&0==Object.keys(c).length&&(y.flyTo({zoom:3}),y.once("moveend",(function(e){b||t.classed("player-fixed-moved",!0).style("top",Y._pos.y+"px").style("left",Y._pos.x+"px"),f=!1})),n())}b&&(ce="267"),p=new YT.Player("player",{height:"100%",width:ce,events:{onReady:function(e){M.on("keyup",de);var t=s.track_link.replace("https://www.youtube.com/watch?v=","");b||pe();q.on("click",(function(e){d3.select(this).select(".song-filter-box").property("checked")?(P=!1,d3.select(this).select(".song-filter-box").property("checked",!1)):(d3.select(this).select(".song-filter-box").property("checked",!0),P=!0),ue(N)})),W.on("click",(function(e){if(d3.select(this).classed("right-song-selected"))P=!1,d3.select(this).classed("right-song-selected",!1),ue(e[0]);else{W.classed("right-song-selected",!1),P=!0,d3.select(this).classed("right-song-selected",!0),ue(e[0]),y.flyTo({center:[1.873,18.301],zoom:1.2}),N=d3.select(this).datum()[0],B=d.get(d3.select(this).datum()[0]).artist_name;var t=d.get(d3.select(this).datum()[0]).track_link;t&&p.cueVideoById(t),q.style("transform",null),F.text((function(e){return N.length>15?N.slice(0,12)+"...":N})),E.text(B),se.text("")}})),L.on("click",(function(e){d3.select(this).classed("muted")?(d3.select(this).classed("muted",!1),p.unMute()):(d3.select(this).classed("muted",!0),p.mute())})),R.classed("paused",!0).on("click",(function(e){d3.select(this).classed("paused")?(d3.select(this).classed("paused",!1),p.pauseVideo()):(d3.select(this).classed("paused",!0),p.playVideo())})),b&&p.cueVideoById(t)},onStateChange:function(e){b&&5==e.data&&!v&&pe()}},enablejsapi:!0,fs:0,playsinline:1})}f=window.setInterval((function(e,t){y.loaded()&&(se(),clearInterval(f))}),500)}))}))}))}))}))}))}q.style("transform","none"),window.onYouTubeIframeAPIReady=function(){mapboxgl.accessToken="pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2trOXV2MW9zMDExbTJvczFydTkxOTJvMiJ9.7qeHgJkUfxOaWEYtBGNU9w",mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",null,!0),J(d)};var V={init:function(){let e=o.get("date");""==e&&(e="202106",o.set("date","202106")),d=e,u=a[d].style,d3.select(".top-toolbar-title-text").select("select").selectAll("option").property("selected",(function(e){return d3.select(this).property("value")===d})),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(b=!0),m=Math.max(document.documentElement.clientWidth,window.innerWidth||0),d3.select(".top-toolbar-info").on("click",(function(e){h.classed("info-modal-visible")?h.classed("info-modal-visible",!1):h.classed("info-modal-visible",!0)})),d3.select(".top-toolbar-title-text").select("select").on("change",(function(e){var t=d3.select(this).property("value");o.set("date",t),console.log(y.getCenter(),y.getZoom()),c.latitude=y.getCenter().lat,c.longitude=y.getCenter().lng,c.zoom=y.getZoom(),J(t)}));var t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},resize:function(){}};const W=d3.select("body");r(),W.classed("is-mobile",i.any()),V.init()}]);